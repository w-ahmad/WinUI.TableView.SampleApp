<Page
x:Class="WinUI.TableView.SampleApp.Pages.GroupingExamplePage"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:tableview="using:WinUI.TableView"
xmlns:local="using:WinUI.TableView.SampleApp"
xmlns:pages="using:WinUI.TableView.SampleApp.Pages"
xmlns:controls="using:WinUI.TableView.SampleApp.Controls"
xmlns:conv="using:WinUI.TableView.SampleApp.Converters"
d:DataContext="{d:DesignInstance Type=local:ExampleViewModel}"
DataContextChanged="OnDataContextChanged"
mc:Ignorable="d">

<Page.Resources>
    <!-- UI Converters for group display -->
    <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
    <conv:BoolToChevronConverter x:Key="BoolToChevronConverter"/>
</Page.Resources>

    <!-- Production-ready grouping demonstration using flattened hierarchy pattern -->
    <controls:SamplePresenter Header="People Grouping"
                              Description="Demonstrates production-ready grouping using the proven flattened hierarchy pattern with expand/collapse functionality.">
        <controls:SamplePresenter.Example>
            <Grid Height="600">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Control Panel -->
                <StackPanel Grid.Row="0" 
                           Orientation="Horizontal" 
                           Spacing="12" 
                           Padding="16,12">
                    <TextBlock Text="Group By:" 
                              VerticalAlignment="Center"
                              FontWeight="SemiBold"/>
                    
                    <ComboBox x:Name="GroupByComboBox" 
                              MinWidth="150"
                              SelectedIndex="1"
                              SelectionChanged="OnGroupByChanged">
                        <ComboBoxItem Content="None" Tag=""/>
                        <ComboBoxItem Content="Department" Tag="Department"/>
                        <ComboBoxItem Content="Gender" Tag="Gender"/>
                        <ComboBoxItem Content="Designation" Tag="Designation"/>
                    </ComboBox>
                    
                    <!-- Group Actions -->
                    <Button Content="Expand All" 
                           Click="OnExpandAll" 
                           Margin="16,0,0,0"
                           Style="{StaticResource DefaultButtonStyle}"/>
                    <Button Content="Collapse All" 
                           Click="OnCollapseAll"
                           Style="{StaticResource DefaultButtonStyle}"/>
                </StackPanel>

                <!-- Main Data Table -->
                <tableview:TableView
                    x:Name="PeopleGroupTable"
                    Grid.Row="1"
                    ItemsSource="{x:Bind FlatItems, Mode=OneWay}"
                    AutoGenerateColumns="False"
                    SelectionMode="Extended"
                    Sorting="OnTableSorting"
                    ClearSorting="OnTableClearSorting"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    CornerRadius="8">
                    
                    <tableview:TableView.Columns>
                        <!-- Group/Name Column with hierarchical display -->
                        <tableview:TableViewTemplateColumn 
                            Header="Group / Name" 
                            Width="2*" 
                            Tag="FirstName" 
                            CanSort="True" 
                            CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <Grid Margin="{x:Bind Indent, Mode=OneWay}">
                                        
                                        <!-- Group Header Display -->
                                        <StackPanel Orientation="Horizontal" 
                                                   Spacing="8"
                                                   Padding="4"
                                                   Visibility="{x:Bind IsGroupHeader, Mode=OneWay}">
                                            <Button Width="24" 
                                                   Height="24" 
                                                   Padding="0" 
                                                   Click="OnToggleGroup"
                                                   Background="Transparent"
                                                   BorderThickness="0"
                                                   ToolTipService.ToolTip="Expand/Collapse Group">
                                                <FontIcon FontFamily="Segoe MDL2 Assets" 
                                                         Glyph="{x:Bind ChevronGlyph, Mode=OneWay}"
                                                         FontSize="12"/>
                                            </Button>
                                            
                                            <FontIcon Glyph="{x:Bind FileIcon, Mode=OneWay}" 
                                                     FontFamily="Segoe MDL2 Assets"
                                                     FontSize="16"
                                                     Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            
                                            <TextBlock Text="{x:Bind DisplayName, Mode=OneWay}" 
                                                      FontWeight="SemiBold"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Data Item Display -->
                                        <StackPanel Orientation="Horizontal" 
                                                   Spacing="8" 
                                                   Padding="8,4"
                                                   Visibility="{x:Bind IsGroupHeader, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                            <FontIcon Glyph="{x:Bind FileIcon, Mode=OneWay}" 
                                                     FontFamily="Segoe MDL2 Assets"
                                                     FontSize="16"
                                                     Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            
                                            <TextBlock Text="{x:Bind DisplayName, Mode=OneWay}"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Email Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Email" Width="2*" Tag="Email" CanSort="True" CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <TextBlock Text="{x:Bind Email, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Department Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Department" Width="*" Tag="Department" CanSort="True" CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <TextBlock Text="{x:Bind Department, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Gender Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Gender" Width="100" Tag="Gender" CanSort="True" CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <TextBlock Text="{x:Bind Gender, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Designation Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Designation" Width="*" Tag="Designation" CanSort="True" CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <TextBlock Text="{x:Bind Designation, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Date of Birth Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Date of Birth" Width="*" Tag="Dob" CanSort="True" CanFilter="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:ExampleFlatGroupItem">
                                    <TextBlock Text="{x:Bind DateOfBirth, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>
                    </tableview:TableView.Columns>
                </tableview:TableView>
            </Grid>
        </controls:SamplePresenter.Example>
        
        <controls:SamplePresenter.Xaml>
            <x:String xml:space="preserve">
&lt;!-- Real TableView grouping using flattened hierarchy pattern -->
public class ExampleFlatGroupItem {
    public ExampleModel? Item { get; }
    public bool IsGroupHeader { get; }
    public string? GroupKey { get; }
    public bool IsExpanded { get; set; }
    public Thickness Indent { get; } // Depth-based indentation
}

&lt;!-- Template handles both group headers and data items -->
&lt;DataTemplate x:DataType="pages:ExampleFlatGroupItem">
    &lt;Grid Margin="{x:Bind Indent}">
        &lt;!-- Group Header with expand/collapse button -->
        &lt;StackPanel Orientation="Horizontal" 
                    Visibility="{x:Bind IsGroupHeader}">
            &lt;Button Click="OnToggleGroup">
                &lt;FontIcon Glyph="{x:Bind ChevronGlyph}"/>
            &lt;/Button>
            &lt;TextBlock Text="{x:Bind DisplayName}" FontWeight="SemiBold"/>
        &lt;/StackPanel>
        
        &lt;!-- Data Item display -->
        &lt;TextBlock Text="{x:Bind DisplayName}"
                   Visibility="{x:Bind IsGroupHeader, Converter=InverseConverter}"/>
    &lt;/Grid>
&lt;/DataTemplate>

// C# - Groups items by property and flattens into single collection
private void RebuildGroupedView() {
    var groups = GroupItemsByProperty(items, "Department");
    FlatItems.Clear();
    
    foreach (var group in groups) {
        FlatItems.Add(new ExampleFlatGroupItem(null, true, group.Key));
        
        if (group.IsExpanded) {
            foreach (var item in group.Items) {
                FlatItems.Add(new ExampleFlatGroupItem(item, false, null));
            }
        }
    }
}
            </x:String>
        </controls:SamplePresenter.Xaml>
    </controls:SamplePresenter>
</Page>
