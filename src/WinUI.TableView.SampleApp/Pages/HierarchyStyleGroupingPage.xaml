<Page
x:Class="WinUI.TableView.SampleApp.Pages.HierarchyStyleGroupingPage"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:tableview="using:WinUI.TableView"
xmlns:local="using:WinUI.TableView.SampleApp"
xmlns:pages="using:WinUI.TableView.SampleApp.Pages"
xmlns:controls="using:WinUI.TableView.SampleApp.Controls"
xmlns:conv="using:WinUI.TableView.SampleApp.Converters"
d:DataContext="{d:DesignInstance Type=local:ExampleViewModel}"
DataContextChanged="OnDataContextChanged"
mc:Ignorable="d">

<Page.Resources>
    <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
</Page.Resources>

    <controls:SamplePresenter Header="Hierarchy-Style Grouping"
                              Description="Groups data using the hierarchy flattening approach. Group headers are treated like expandable parent nodes, and items are children. This gives you fine-grained control over expand/collapse behavior, similar to the Hierarchy example.">
        <controls:SamplePresenter.Example>
            <Grid Height="600">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <StackPanel Orientation="Horizontal" Spacing="8" Padding="8">
                    <TextBlock Text="Group By:" VerticalAlignment="Center"/>
                    <ComboBox x:Name="GroupByComboBox" 
                              MinWidth="150"
                              SelectedIndex="1"
                              SelectionChanged="OnGroupByChanged">
                        <ComboBoxItem Content="None" Tag=""/>
                        <ComboBoxItem Content="Department" Tag="Department"/>
                        <ComboBoxItem Content="Gender" Tag="Gender"/>
                        <ComboBoxItem Content="Designation" Tag="Designation"/>
                    </ComboBox>
                    <Button Content="Expand All" Click="OnExpandAll" Margin="16,0,0,0"/>
                    <Button Content="Collapse All" Click="OnCollapseAll"/>
                </StackPanel>

                <tableview:TableView
                    x:Name="HierarchyGroupTable"
                    Grid.Row="1"
                    ItemsSource="{x:Bind FlatItems, Mode=OneWay}"
                    AutoGenerateColumns="False"
                    SelectionMode="Extended"
                    Sorting="OnTableSorting"
                    ClearSorting="OnTableClearSorting">
                    
                    <tableview:TableView.Columns>
                        <!-- Group/Name Column with expand/collapse button -->
                        <tableview:TableViewTemplateColumn Header="Group / Name" Width="2*" Tag="FirstName" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <!-- Group Header Row -->
                                    <Grid x:Name="RootGrid" Margin="{x:Bind Indent, Mode=OneWay}">
                                        <!-- Group Header Style -->
                                        <StackPanel Orientation="Horizontal" 
                                                    Spacing="8"
                                                    Visibility="{x:Bind IsGroupHeader, Mode=OneWay}">
                                            <Button Width="24" Height="24" 
                                                    Padding="0" 
                                                    Click="OnToggleGroup"
                                                    Background="Transparent"
                                                    BorderThickness="0">
                                                <FontIcon FontFamily="Segoe MDL2 Assets" 
                                                         Glyph="{x:Bind ChevronGlyph, Mode=OneWay}"
                                                         FontSize="12"/>
                                            </Button>
                                            <TextBlock Text="{x:Bind Item, Mode=OneWay}" 
                                                      FontWeight="SemiBold"
                                                      VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Data Item Style -->
                                        <TextBlock Text="{x:Bind DataItem.FirstName, Mode=OneWay}"
                                                  VerticalAlignment="Center"
                                                  Visibility="{x:Bind IsGroupHeader, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                    </Grid>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Last Name Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Last Name" Width="*" Tag="LastName" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <TextBlock Text="{x:Bind DataItem.LastName, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Email Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Email" Width="2*" Tag="Email" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <TextBlock Text="{x:Bind DataItem.Email, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Department Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Department" Width="*" Tag="Department" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <TextBlock Text="{x:Bind DataItem.Department, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Gender Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Gender" Width="100" Tag="Gender" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <TextBlock Text="{x:Bind DataItem.Gender, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>

                        <!-- Designation Column (only shows for data items) -->
                        <tableview:TableViewTemplateColumn Header="Designation" Width="*" Tag="Designation" CanSort="True">
                            <tableview:TableViewTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="pages:FlatGroupItem">
                                    <TextBlock Text="{x:Bind DataItem.Designation, Mode=OneWay}"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </tableview:TableViewTemplateColumn.CellTemplate>
                        </tableview:TableViewTemplateColumn>
                    </tableview:TableView.Columns>
                </tableview:TableView>
            </Grid>
        </controls:SamplePresenter.Example>
        
        <controls:SamplePresenter.Xaml>
            <x:String xml:space="preserve">
&lt;!-- Define FlatGroupItem wrapper class -->
public class FlatGroupItem {
    public object Item { get; }          // Group key or data item
    public int Depth { get; }            // 0 for headers, 1 for items
    public bool IsGroupHeader { get; }   // True for group headers
    public bool IsExpanded { get; set; } // Expansion state
}

&lt;!-- Flatten groups similar to HierarchyPage -->
void RebuildGroupedView() {
    FlatItems.Clear();
    var groups = GroupItemsByProperty(items, "Department");
    
    foreach (var group in groups) {
        // Add group header at depth 0
        FlatItems.Add(new FlatGroupItem(group.Key, 0, true));
        
        if (group.IsExpanded) {
            // Add items at depth 1
            foreach (var item in group.Items) {
                FlatItems.Add(new FlatGroupItem(item, 1, false));
            }
        }
    }
}

&lt;tableview:TableView ItemsSource="{Binding FlatItems}">
    &lt;!-- Use templates to show different UI for headers vs items -->
&lt;/tableview:TableView>
            </x:String>
        </controls:SamplePresenter.Xaml>
    </controls:SamplePresenter>
</Page>
